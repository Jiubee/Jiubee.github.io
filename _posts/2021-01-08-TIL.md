---
layout:     post
title:      2021/01/08
date:       2021-01-08
summary:    Today I Learned - 2021/01/08
categories: TIL
---

## W3Challs - My Little Pony CEH (Reversing, 6pts)

오늘은 어제보다는 쉬운 문제로 들고 왔다. 다만 이 문제는 이전까지 풀었던 문제들과는 달리 PE 파일이 아닌 어도비 플래시 파일이라는 점이 특이사항이다.
사실 플래시를 다뤄본 적은 없었고, 애초에 올해부터는 보안 지원도 종료된 사실상 죽은 소프트웨어라고 생각하고 있어서 굳이 손을 대지 않았지만...
그냥 경험 삼아서 가볍게(?) 풀어봐도 괜찮겠다 싶어서 풀어보기로 했다!

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991963-cb43c700-51d6-11eb-9b51-cf1efabdbcd3.png"></p>
<center>[그림 1] My little pony</center><br>

메인 PC에서 실행시키기엔 뭔가 찜찜해서.. 평소 분석 용도로 사용하는 VM에서 실행해보았다.
당연히 악성 파일은 아니고, 그냥 평범해보이는 마이 리틀 포니 플래시 게임 비스무리한게 나온다.
이 플래시에서는 아래 [그림 2]와 같은 식으로 프랑스어로 쓰인 여러 문제가 나오고, 마지막에는 [그림 3]과 같이 'You failed!'라는 메시지를 출력한다.
아마 주어진 문제들을 모두 맞출 때 플래그가 출력되는 형태일 듯 하다.

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991968-cc74f400-51d6-11eb-836f-f9c368241bbb.png"></p>
<center>[그림 2] Questions</center><br>

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991971-cd0d8a80-51d6-11eb-9fdb-9f2388440880.png"></p>
<center>[그림 3] Failed!</center><br>

그렇다면 마이 리틀 포니를 잘 아는 사람에게 물어볼 수도 있겠지만, 주변에 그런 사람은 없고.. 나 역시 그런 사람은 아니다.
그러니 그나마 할 줄 아는 리버싱으로 풀 수 밖에 없다.

아무튼, 이제 실행흐름을 알아보았으니 본격적으로 분석에 들어갈 차례다. 그런데... 문제 파일을 다운로드하는 링크가 보이지 않는다.
W3Challs 페이지에서는 단지 웹에서 플래시를 보여줄 뿐, 해당 파일 자체를 제공하고 있지는 않았다.
그래서 어떻게 파일을 구해야하나 생각하던 중, 이 화면의 소스코드 내 플래시 파일과 관련된 부분이 있을 것이라 생각하여
브라우저의 개발자 도구를 열고 'swf'를 키워드로 검색해봤더니..

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991972-cd0d8a80-51d6-11eb-9aef-da7db7b7a78b.png"></p>
<center>[그림 4] Bingo!</center><br>

예상대로 코드 안에 해당 플래시 파일의 주소가 담겨져있었고, 주소를 입력하니 곧바로 swf 파일을 다운로드할 수 있었다.
그럼 이제 분석을 하면 되는데, 알다시피 이 파일은 PE 파일이 아닌 Flash 파일이므로 별도의 분석툴을 사용해야 한다.
개인적으로 플래시 분석 도구를 잘 알지는 못해서, 그냥 내가 애용하고 있는 Flare VM에서 설치해준 FFdec이라는 도구를 사용하였다.

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991973-cda62100-51d6-11eb-94ec-7d0f98f48ce3.png"></p>
<center>[그림 5] Flash Decompiled</center><br>

[그림 5]에서 좌측을 보면, 다양한 폴더들이 존재하는데 해당 폴더들의 이름에 맞는 리소스들이 들어있음을 알 수 있었다.
혹시나 해서 모든 폴더들을 다 살펴봤지만, 플래그라고 할만한 부분은 역시 보이지 않았다.
맨 마지막에 보이는 scripts 폴더로 가서 이 파일의 소스코드를 확인하고 플래그를 얻어야 한다.

여기서도 문자열 검색 기능이 있어서 아까 결과 화면에서 보았던 'You failed'를 검색해보았다.
그랬더니, 'q_3' 파일에서 해당 문자열이 잡혔고 해당 소스를 좀 더 살펴본 결과 플래그를 얻는 방법을 정확히 알 수 있었다.

요약하자면, 예상대로 모든 문제를 맞춰야 플래그가 출력되는 방식이며 다행히 소스코드를 통해 모든 문제의 정답을 알 수 있었다.

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991974-cda62100-51d6-11eb-9c38-a47bc99644cd.png"></p>
<center>[그림 6] 소스코드 중 일부</center><br>

위 [그림 6]에서 볼 수 있듯, 각 문제의 정답을 판별하는 루틴은 매우 단순하게 구성되어있어 모든 문제의 정답을 쉽게 알 수 있다.
20문제나 되어서 귀찮긴 했지만 그래도 전혀 어렵지 않게 플래그를 얻을 수 있었다!

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991976-ce3eb780-51d6-11eb-9b9b-e244191b26cb.png"></p>
<center>[그림 7] Flag</center><br>

참고로 플래그는 모든 답안을 문제 순서대로 쭉 나열한 모습이었다.
그래서 굳이 문제를 다시 풀 것 없이 답을 구했으면 바로 플래그를 만들 수 있다.
아무튼 그렇게 얻은 플래그를 입력하면 6점을 얻을 수 있다!

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103991977-ce3eb780-51d6-11eb-8d09-204b685dcd78.png"></p>
<center>[그림 8] 풀이 완료!</center><br>

난이도는 상당히 쉬운 문제였지만 그래도 나름 재미있었고, 플래시에 대해 좀 더 잘 알게 된 것 같다.