---
layout:     post
title:      2021/01/04
date:       2021-01-04 20:00
summary:    Today I Learned - 2021/01/04
categories: TIL
---

## 1. W3Challs - First steps on Windows (Reversing, 3pts)

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103515317-da163b00-4eb1-11eb-94c1-13383e5ffe39.png"></p>
<center>[그림 1] 프로그램 실행 화면</center><br>

이 프로그램을 실행하면 위 사진과 같이 문자열을 입력할 수 있다.
조건을 만족하는 특정 문자열을 입력하면 flag가 출력되는 형태의 프로그램인 듯 하다.

Ghidra를 사용하여 해당 프로그램을 분석해보자.

우선 Defined Strings를 통해 Main 함수를 찾아보기로 했다.
위 사진에 출력된 문자열 중 'Invalid password'를 검색했더니 FUN_401d70 함수 내 포함된 문자열로 나온다. 그 외에도 이런저런 문자열들이 포함된 것으로 보아 여기가 메인임이 확실하다.

이제 메인을 찾았으니 분석하는 일만 남았다.

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103515322-db476800-4eb1-11eb-9cc2-b8ffbf4ec063.png"></p>
<center>[그림 2] Main 함수 중 일부</center><br>

위 사진의 코드가 입력한 문자열을 검증하는 부분인 듯 하다.

입력값과 임의의 데이터 2개를 XOR 연산을 총 0x21(33)번 반복한다.
이 때 XOR 연산의 결과는 0이 되어야 한다. 즉, 입력값[i] ^ XOR_arr[i] ^ XOR_arr_2[i] == 0이 되어야 한다는 것이다.

그리고, 올바른 입력값을 넣었을 때 'use it as the flag'라는 글이 출력되는 것으로 보아 입력값이 플래그가 되는 듯 하다.

그렇다면 입력값과 XOR을 하는 데이터들을 알면 바로 플래그를 확인할 수 있을 것이다.

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103515325-dbdffe80-4eb1-11eb-86a1-1333d27cf6cf.png"></p>
<center>[그림 3] XOR 연산 데이터셋</center><br>

해당 데이터들 역시 기드라에서 확인할 수 있다. 
다만 기드라에서 추출하는 건 좀 귀찮아서, 나는 HxD를 이용해서 가져왔다.
각각 34바이트씩 가져오면 된다. 입력값의 총 길이는 마지막 NULL값을 포함해 총 34바이트이기 때문!

어쨌든 데이터를 추출했으면 간단한 코드를 짜서 플래그를 얻을 수 있다.
밑의 코드는 내가 만든 python 코드다. 부족하지만 참고에 도움이 됐으면 좋겠다.

```{.python}
import string

array1 = [0xEE, 0x81, 0x29, 0x75, 0x9C, 0x97, 0x16, 0xF4, 0xDA, 0x03, 0xDE,
          0xF8, 0xD5, 0xF8, 0xD6, 0x19, 0x0F, 0x6F, 0x4C, 0x15, 0xAC, 0x59,
          0xCF, 0x85, 0xA6, 0xB0, 0x25, 0x1B, 0x88, 0xA7, 0xA8, 0xD1, 0x06, 0x00]

array2 = [0xB9, 0xB2, 0x6A, 0x0E, 0xCB, 0xA4, 0x7A, 0x97, 0xEA, 0x6E, 0xED,
          0xD8, 0x82, 0xC9, 0xE1, 0x71, 0x2F, 0x38, 0x7D, 0x7B, 0xC8, 0x69,
          0xB8, 0xB0, 0x86, 0xF3, 0x57, 0x2F, 0xEB, 0xCC, 0xC5, 0xE2, 0x7B, 0x00]

i = 0
flag = ''

while (i < 0x21):
    for a in string.printable:
        if ord(a) ^ array1[i] ^ array2[i] == 0:
            flag += a
            i += 1

print(flag)
```

해당 코드를 실행하면 플래그값을 바로 얻을 수 있다. w3challs에서 가서 입력하면 3점을 얻을 수 있다!

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103515327-dc789500-4eb1-11eb-956c-0f61a4a5c089.png)"></p>
<center>[그림 4] Flag</center><br>

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103515329-dc789500-4eb1-11eb-9060-976f295f129b.png"></p>
<center>[그림 5] 풀이 완료!</center><br>

여담으로 이 프로그램에는 디버깅 탐지 루틴이 달려있어서 디버거로 동적 분석하려면 조금 귀찮아진다. 제일 쉬운 문제인데 왜 달려있지...

<p align="center"><img src="https://user-images.githubusercontent.com/75083364/103515331-dd112b80-4eb1-11eb-8eb9-6973dfae8fae.png"></p>